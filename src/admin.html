<!doctype html>
<html lang="en" class="auth-pending">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ¬∑ City Experts</title>
  <meta name="robots" content="noindex, nofollow">
  <script>document.documentElement.classList.add('auth-pending');</script>
  <script type="module" src="/js/main.js"></script>
  <script type="module" src="/js/hero-loader.js"></script>
  <style>
    /* Hide dashboard by default until session confirmed */
    .auth-pending #dashView { display: none !important; }
    .auth-pending #loginView { display: block !important; }
    .auth-pending .authed { display: none !important; }
    .auth-pending .admin-header { display: none !important; }
    /* When authed: inverse */
    .authed #dashView { display: block !important; }
    .authed #loginView { display: none !important; }
    .authed .admin-header { display: block !important; }

    /* Simplified Admin Styling */
    body { background: #f8fafc; }
    .admin-section {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    }
    
    .admin-section h2 {
      font-size: 20px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 16px;
      border-bottom: 2px solid #f3f4f6;
      padding-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .simple-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }
    
    .simple-item {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      transition: all 0.2s;
    }
    
    .simple-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    
    .simple-item img {
      max-width: 120px;
      max-height: 80px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 8px;
      border: 1px solid #e5e7eb;
    }
    
    .project-item {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.2s;
    }
    
    .project-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 4px -1px rgb(0 0 0 / 0.1);
    }
    
    .project-item img {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 4px;
      flex-shrink: 0;
      border: 1px solid #e5e7eb;
    }
    
    .project-info {
      flex: 1;
    }
    
    .project-title {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 4px;
    }
    
    .project-meta {
      font-size: 14px;
      color: #6b7280;
    }
    
    .featured-star {
      color: #fbbf24;
      font-size: 18px;
    }
    
    .btn-icon {
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      color: #374151;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .btn-icon:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    
    .btn-icon.primary {
      background: #3b82f6;
      border-color: #3b82f6;
      color: white;
    }
    
    .btn-icon.primary:hover {
      background: #2563eb;
    }
    
    .upload-area {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      background: #fafafa;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .upload-area:hover {
      border-color: #9ca3af;
    }
    
    .upload-area.dragover {
      border-color: #3b82f6;
      background: #eff6ff;
    }
    
    .help-box {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .help-text {
      color: #6b7280;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .form-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-published {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-draft {
      background: #fef3c7;
      color: #92400e;
    }
    
    /* Modal styles */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .modal-panel {
      background: white;
      border-radius: 12px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      .simple-grid { grid-template-columns: 1fr; }
      .project-item { flex-direction: column; text-align: center; }
      .project-item img { width: 100%; height: auto; max-height: 200px; }
    }
  </style>
  <script type="module" src="/js/admin.js"></script>
</head>
<body>
  <!-- Header -->
  <nav id="site-header" class="fixed top-0 inset-x-0 z-40 bg-white border-b border-gray-200">
    <div class="container-custom">
      <div class="flex h-16 items-center justify-between">
        <a href="/" class="header-logo flex items-center gap-3" aria-label="City Experts Home">
          <img src="/assets/images/city-experts-logo.svg" alt="City Experts" class="h-8 w-auto">
          <span class="font-playfair text-lg font-semibold text-deep-charcoal">City Experts Admin</span>
        </a>
        <div class="authed">
          <a href="/" class="btn btn-secondary text-sm" style="margin-right: 12px;">View Site</a>
          <button id="logoutBtn" class="btn btn-secondary text-sm">Log out</button>
        </div>
      </div>
    </div>
  </nav>

  <main style="padding-top: 5rem;">
    <div class="container" style="max-width: 1200px; margin: 0 auto;">

      <!-- LOGIN -->
      <section id="loginView" class="admin-section" style="max-width:400px;margin:2rem auto;">
        <h2>üîê Admin Login</h2>
        <form id="loginForm" novalidate>
          <div style="margin-bottom: 16px;">
            <label class="text-charcoal" for="email">Email</label>
            <input id="email" name="email" type="email" required class="input" />
          </div>
          <div style="margin-bottom: 16px;">
            <label class="text-charcoal" for="password">Password</label>
            <input id="password" name="password" type="password" required class="input" />
          </div>
          <div style="display:flex;gap:12px;align-items:center;">
            <button class="btn-primary" type="submit">Sign in</button>
            <span id="loginStatus" class="hero-sub" aria-live="polite"></span>
          </div>
        </form>
      </section>

      <!-- DASHBOARD -->
      <section id="dashView" class="authed" hidden>
        
        <!-- Welcome Box -->
        <div class="help-box">
          <p style="margin: 0;"><strong>üëã Welcome to City Experts Admin!</strong> Manage your projects, featured content, and page headers all in one place. The logo is protected and cannot be changed to maintain brand consistency.</p>
        </div>

        <!-- Featured Projects -->
        <div class="admin-section">
          <h2>‚≠ê Featured Projects</h2>
          <p class="help-text">These projects appear on your homepage. Click "Remove" to unfeature or "Feature" to add projects to homepage.</p>
          
          <div id="featuredList">
            <div style="text-align:center;padding:40px;color:#9ca3af">
              Loading featured projects...
            </div>
          </div>
        </div>

        <!-- Page Headers -->
        <div class="admin-section">
          <h2>üñºÔ∏è Page Headers</h2>
          <p class="help-text">Replace header images for each page of your website.</p>
          
          <div class="simple-grid">
            <div class="simple-item">
              <div id="homeHeaderPreview">
                <img src="/assets/images/hero-dubai-skyline.webp" alt="Home page header">
              </div>
              <h3 style="margin: 8px 0 4px; font-weight: 600;">Home Page</h3>
              <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
                <input type="file" id="homeHeaderFile" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
                <button onclick="document.getElementById('homeHeaderFile').click()" class="btn-icon">Replace</button>
              </div>
            </div>
            
            <div class="simple-item">
              <div id="aboutHeaderPreview">
                <img src="/assets/images/about-hero.webp" alt="About page header">
              </div>
              <h3 style="margin: 8px 0 4px; font-weight: 600;">About Page</h3>
              <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
                <input type="file" id="aboutHeaderFile" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
                <button onclick="document.getElementById('aboutHeaderFile').click()" class="btn-icon">Replace</button>
              </div>
            </div>
            
            <div class="simple-item">
              <div id="servicesHeaderPreview">
                <img src="/assets/images/hero-dubai-skyline.webp" alt="Services page header">
              </div>
              <h3 style="margin: 8px 0 4px; font-weight: 600;">Services Page</h3>
              <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
                <input type="file" id="servicesHeaderFile" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
                <button onclick="document.getElementById('servicesHeaderFile').click()" class="btn-icon">Replace</button>
              </div>
            </div>
            
            <div class="simple-item">
              <div id="projectsHeaderPreview">
                <img src="/assets/images/projects-hero.webp" alt="Projects page header">
              </div>
              <h3 style="margin: 8px 0 4px; font-weight: 600;">Projects Page</h3>
              <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
                <input type="file" id="projectsHeaderFile" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
                <button onclick="document.getElementById('projectsHeaderFile').click()" class="btn-icon">Replace</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Team Management -->
        <div class="admin-section">
          <h2>üë• Team Management</h2>
          <p class="help-text">Manage your leadership team members displayed on the About Us page.</p>
          
          <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
            <button id="addTeamMember" class="btn-primary">+ Add New Team Member</button>
            <button id="refreshTeam" class="btn-secondary">Refresh Team List</button>
          </div>
          
          <div id="teamList">
            <div style="text-align:center;padding:40px;color:#9ca3af">
              Loading team members...
            </div>
          </div>
          
          <!-- Team Member Form Modal -->
          <div id="teamModal" class="modal" style="display: none;">
            <div class="modal-content">
              <div class="modal-header">
                <h3 id="teamModalTitle">Add Team Member</h3>
                <button id="closeTeamModal" class="modal-close">&times;</button>
              </div>
              
              <form id="teamForm">
                <input type="hidden" id="teamMemberId">
                
                <div style="margin-bottom: 16px;">
                  <label for="teamName">Full Name *</label>
                  <input type="text" id="teamName" class="input" required placeholder="e.g., Ahmed Al-Mansouri">
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label for="teamPosition">Position *</label>
                  <input type="text" id="teamPosition" class="input" required placeholder="e.g., Chief Executive Officer">
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label for="teamExpertise">Expertise Tag</label>
                  <input type="text" id="teamExpertise" class="input" placeholder="e.g., 20+ years construction leadership">
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label for="teamBio">Biography *</label>
                  <textarea id="teamBio" class="input" rows="4" required placeholder="Professional background and achievements..."></textarea>
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label for="teamEmail">Email</label>
                  <input type="email" id="teamEmail" class="input" placeholder="name@cityexperts.ae">
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label for="teamLinkedin">LinkedIn URL</label>
                  <input type="url" id="teamLinkedin" class="input" placeholder="https://linkedin.com/in/...">
                </div>
                
                <div style="margin-bottom: 16px;">
                  <label>Portrait Image (800x800, ‚â§1MB)</label>
                  <div style="display: flex; gap: 12px; align-items: center; margin-top: 8px;">
                    <input type="file" id="teamPortraitFile" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
                    <button type="button" onclick="document.getElementById('teamPortraitFile').click()" class="btn-secondary">Choose Image</button>
                    <span id="teamPortraitStatus" style="font-size: 14px; color: #6b7280;">No image selected</span>
                  </div>
                  <div id="teamPortraitPreview" style="margin-top: 12px; display: none;">
                    <img style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="submit" class="btn-primary">Save Team Member</button>
                  <button type="button" id="cancelTeamForm" class="btn-secondary">Cancel</button>
                  <span id="teamFormStatus" style="margin-left: 12px; font-size: 14px;"></span>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Project Image Upload -->
        <div class="admin-section">
          <h2>üì∑ Replace Project Images</h2>
          <p class="help-text">Upload new images for your projects. Select a project and image type, then upload.</p>
          
          <form id="uploadForm">
            <div class="form-grid">
              <div>
                <label class="text-charcoal" style="font-weight:600;">Select Project*</label>
                <select id="uploadProjectSelect" class="input" required>
                  <option value="" disabled selected>Choose a project...</option>
                </select>
              </div>
              <div>
                <label class="text-charcoal" style="font-weight:600;">Image Type*</label>
                <select id="uploadImageType" class="input" required>
                  <option value="" disabled selected>Choose image type...</option>
                  <option value="hero">Hero Image (main project image)</option>
                  <option value="thumb">Thumbnail (project list)</option>
                  <option value="gallery">Gallery Image</option>
                </select>
              </div>
            </div>
            
            <div class="upload-area" id="uploadArea">
              <div style="margin-bottom: 12px;">
                <svg style="width: 48px; height: 48px; color: #9ca3af; margin: 0 auto;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
              </div>
              <p style="margin: 0 0 8px; font-weight: 500;">Drop your image here or click to browse</p>
              <p style="margin: 0; color: #6b7280; font-size: 14px;">Supports: JPG, PNG, WebP (max 2MB)</p>
              <input id="uploadFile" type="file" accept=".jpg,.jpeg,.png,.webp" style="display: none;">
            </div>
            
            <div class="form-actions">
              <button id="uploadBtn" class="btn-primary" type="submit" disabled>Upload Image</button>
              <span id="uploadStatus" class="hero-sub" aria-live="polite"></span>
            </div>
            
            <div id="uploadPreview" style="margin-top: 16px;"></div>
          </form>
        </div>

        <!-- All Projects -->
        <div class="admin-section">
          <h2>üìã Published Projects (Live Website)</h2>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
            <p class="help-text" style="margin: 0;">Shows all published projects that are live on your website. Click "Feature" to add to homepage, "Edit" to modify, or "Images" to replace images.</p>
            <button id="newProjectBtn" class="btn-icon primary">+ New Project</button>
          </div>
          
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <input id="projSearch" class="input" placeholder="Search published projects..." style="max-width:300px">
            <select id="projFilterStatus" class="input" style="max-width:150px">
              <option value="published">Published (Live)</option>
              <option value="">All Projects</option>
              <option value="draft">Drafts Only</option>
            </select>
          </div>
          
          <div id="projectsList">
            <div style="text-align:center;padding:40px;color:#9ca3af">
              Loading projects...
            </div>
          </div>
        </div>

      </section>
    </div>

    <!-- Project Modal -->
    <div id="modal-backdrop" class="fixed inset-0 modal-backdrop hidden opacity-0 transition-opacity z-40"></div>
    <div id="projModal" class="fixed inset-0 hidden z-50 items-start justify-center overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="projModalTitle" aria-hidden="true">
      <div class="mx-auto my-8 w-full max-w-4xl modal-panel outline-none" style="padding:24px" tabindex="-1" id="projModalPanel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <h3 id="projModalTitle" class="text-charcoal" style="font-size:20px;font-weight:700">Edit Project</h3>
          <button id="projClose" class="btn-icon" data-modal-close>Close</button>
        </div>

        <form id="projForm" novalidate>
          <!-- Basic Fields -->
          <div class="form-grid">
            <div>
              <label>Project Name*</label>
              <input id="f_title_en" class="input" required placeholder="e.g., Marina Tower">
            </div>
            <div>
              <label>Project ID*</label>
              <input id="f_id" class="input" required pattern="^[a-z0-9-]+$" placeholder="e.g., marina-tower">
              <small style="color:#6b7280;font-size:12px;">Lowercase letters, numbers, hyphens only</small>
            </div>
            <div>
              <label>Category*</label>
              <select id="f_category" class="input" required>
                <option value="">Select category...</option>
                <option value="commercial">Commercial</option>
                <option value="residential">Residential</option>
                <option value="interiors">Interior Design</option>
                <option value="mixed">Mixed Use</option>
                <option value="hospitality">Hospitality</option>
                <option value="retail">Retail</option>
              </select>
            </div>
            <div>
              <label>Status*</label>
              <select id="f_status" class="input" required>
                <option value="draft">Draft (Hidden)</option>
                <option value="published">Published (Live)</option>
              </select>
            </div>
            <div>
              <label>City</label>
              <input id="f_city" class="input" placeholder="e.g., Dubai">
            </div>
            <div>
              <label>Client</label>
              <input id="f_client" class="input" placeholder="Client name">
            </div>
          </div>
          
          <div style="margin-bottom:16px">
            <label>Brief Description</label>
            <textarea id="f_excerpt_en" class="input" rows="2" placeholder="Brief description for project cards..."></textarea>
          </div>
          
          <div style="margin-bottom:16px">
            <label>Full Description</label>
            <textarea id="f_description_en" class="input" rows="4" placeholder="Detailed project description (supports Markdown)..."></textarea>
          </div>
          
          <div style="display:flex;gap:16px;align-items:center;margin-bottom:16px;flex-wrap:wrap;">
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="f_featured"> 
              <span>‚≠ê Feature on homepage</span>
              <span id="heroValidation" style="font-size:12px;margin-left:8px;"></span>
            </label>
            <div style="display:flex;gap:8px;align-items:center;">
              <label style="font-size:14px;">Order:</label>
              <input id="f_order" type="number" class="input" value="0" min="0" style="width:80px;" placeholder="0">
              <small style="color:#6b7280;font-size:12px;">Lower numbers appear first</small>
            </div>
          </div>

          <div class="form-actions" style="margin-top:20px;">
            <button id="projSave" class="btn-primary" type="submit">Save Project</button>
            <button id="projDelete" class="btn-secondary" type="button">Delete</button>
            <span id="projStatus" class="hero-sub" aria-live="polite"></span>
          </div>
        </form>
      </div>
    </div>

  </main>
</body>
</html>